@model DKMovies.Models.ViewModels.DashboardViewModel
@{
    ViewData["Title"] = "Bảng điều khiển quản trị";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    /* Override layout issues */
    .admin-content {
        margin-left: 280px !important;
        padding-top: 80px !important;
    }

        .admin-content.sidebar-collapsed {
            margin-left: 70px !important;
        }


    {
        margin-left: 0 !important;
        padding-top: 80px !important;
    }

    }
</style>

<!-- Dashboard Content - No container-fluid needed as it's in layout -->
<div class="mb-4">
    <div class="d-flex align-items-center justify-content-between">
        <div>
            <h1 class="h3 mb-1 fw-bold text-dark">Tổng quan hệ thống</h1>
            <p class="text-muted mb-0">Quản lý và theo dõi hoạt động DKMovies</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-primary btn-sm">
                <i class="fas fa-sync-alt me-1"></i>Làm mới
            </button>
            <button class="btn btn-primary btn-sm">
                <i class="fas fa-plus me-1"></i>Thêm mới
            </button>
        </div>
    </div>
</div>

@if (ViewBag.ErrorMessage != null)
{
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        @ViewBag.ErrorMessage
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<!-- Dashboard Statistics Cards -->
<div class="row g-4 mb-4">
    <!-- Users Card -->
    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100 overflow-hidden position-relative dashboard-card">
            <div class="card-body text-white p-4 position-relative" style="background: linear-gradient(135deg, #17a2b8, #0d6efd);">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <div class="text-uppercase small opacity-75 mb-2">Người dùng</div>
                        <div class="h4 mb-0 fw-bold">@(ViewBag.TotalUsers ?? 0)</div>
                    </div>
                    <div class="bg-white bg-opacity-25 rounded-circle p-2">
                        <i class="fas fa-users fs-5"></i>
                    </div>
                </div>
                <div class="progress" style="height: 4px;">
                    <div class="progress-bar bg-white opacity-50" style="width: 75%"></div>
                </div>
            </div>
            <a href="@Url.Action("Index", "AdminUser")"
               class="card-footer bg-white border-0 text-info text-decoration-none py-3 hover-effect">
                <div class="d-flex justify-content-between align-items-center small fw-medium">
                    <span>Xem chi tiết</span>
                    <i class="fas fa-arrow-right transition-icon"></i>
                </div>
            </a>
        </div>
    </div>

    <!-- Employees Card -->
    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100 overflow-hidden position-relative dashboard-card">
            <div class="card-body text-white p-4 position-relative" style="background: linear-gradient(135deg, #28a745, #20c997);">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <div class="text-uppercase small opacity-75 mb-2">Nhân viên</div>
                        <div class="h4 mb-0 fw-bold">@(ViewBag.TotalEmployees ?? 0)</div>
                    </div>
                    <div class="bg-white bg-opacity-25 rounded-circle p-2">
                        <i class="fas fa-user-tie fs-5"></i>
                    </div>
                </div>
                <div class="progress" style="height: 4px;">
                    <div class="progress-bar bg-white opacity-50" style="width: 60%"></div>
                </div>
            </div>
            <a href="@Url.Action("Index", "AdminEmployee")"
               class="card-footer bg-white border-0 text-success text-decoration-none py-3 hover-effect">
                <div class="d-flex justify-content-between align-items-center small fw-medium">
                    <span>Xem chi tiết</span>
                    <i class="fas fa-arrow-right transition-icon"></i>
                </div>
            </a>
        </div>
    </div>

    <!-- Movies Card -->
    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100 overflow-hidden position-relative dashboard-card">
            <div class="card-body text-white p-4 position-relative" style="background: linear-gradient(135deg, #ffc107, #fd7e14);">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <div class="text-uppercase small opacity-75 mb-2">Phim</div>
                        <div class="h4 mb-0 fw-bold">@(ViewBag.TotalMovies ?? 0)</div>
                    </div>
                    <div class="bg-white bg-opacity-25 rounded-circle p-2">
                        <i class="fas fa-film fs-5"></i>
                    </div>
                </div>
                <div class="progress" style="height: 4px;">
                    <div class="progress-bar bg-white opacity-50" style="width: 85%"></div>
                </div>
            </div>
            <a href="@Url.Action("Index", "AdminMovie")"
               class="card-footer bg-white border-0 text-warning text-decoration-none py-3 hover-effect">
                <div class="d-flex justify-content-between align-items-center small fw-medium">
                    <span>Quản lý phim</span>
                    <i class="fas fa-arrow-right transition-icon"></i>
                </div>
            </a>
        </div>
    </div>

    <!-- ShowTimes Card -->
    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100 overflow-hidden position-relative dashboard-card">
            <div class="card-body text-white p-4 position-relative" style="background: linear-gradient(135deg, #dc3545, #e83e8c);">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <div class="text-uppercase small opacity-75 mb-2">Suất chiếu</div>
                        <div class="h4 mb-0 fw-bold">@(ViewBag.TotalShowTimes ?? 0)</div>
                    </div>
                    <div class="bg-white bg-opacity-25 rounded-circle p-2">
                        <i class="fas fa-clock fs-5"></i>
                    </div>
                </div>
                <div class="progress" style="height: 4px;">
                    <div class="progress-bar bg-white opacity-50" style="width: 70%"></div>
                </div>
            </div>
            <a href="@Url.Action("Index", "AdminShowTime")"
               class="card-footer bg-white border-0 text-danger text-decoration-none py-3 hover-effect">
                <div class="d-flex justify-content-between align-items-center small fw-medium">
                    <span>Quản lý suất chiếu</span>
                    <i class="fas fa-arrow-right transition-icon"></i>
                </div>
            </a>
        </div>
    </div>
</div>

<!-- Second Row -->
<div class="row g-4 mb-4">
    <!-- Concessions Card -->
    <div class="col-xl-4">
        <div class="card border-0 shadow-sm h-100 overflow-hidden position-relative dashboard-card">
            <div class="card-body text-white p-4 position-relative" style="background: linear-gradient(135deg, #6c757d, #495057);">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <div class="text-uppercase small opacity-75 mb-2">Món ăn</div>
                        <div class="h4 mb-0 fw-bold">@(ViewBag.TotalConcessions ?? 0)</div>
                    </div>
                    <div class="bg-white bg-opacity-25 rounded-circle p-2">
                        <i class="fas fa-utensils fs-5"></i>
                    </div>
                </div>
                <div class="progress" style="height: 4px;">
                    <div class="progress-bar bg-white opacity-50" style="width: 45%"></div>
                </div>
            </div>
            <a href="@Url.Action("Index", "AdminConcession")"
               class="card-footer bg-white border-0 text-secondary text-decoration-none py-3 hover-effect">
                <div class="d-flex justify-content-between align-items-center small fw-medium">
                    <span>Quản lý món ăn</span>
                    <i class="fas fa-arrow-right transition-icon"></i>
                </div>
            </a>
        </div>
    </div>

    <!-- Revenue Card -->
    <div class="col-xl-8">
        <div class="card border-0 shadow-sm h-100 overflow-hidden position-relative dashboard-card">
            <div class="card-body text-white p-4 position-relative" style="background: linear-gradient(135deg, #343a40, #495057);">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="flex-grow-1">
                        <div class="text-uppercase small opacity-75 mb-2">Tổng doanh thu (Từ vé bán)</div>
                        <div class="h3 mb-2 fw-bold">
                            @String.Format("{0:N0} ₫", ViewBag.TotalRevenue ?? 0)
                        </div>
                        <div class="small opacity-75">
                            <i class="fas fa-arrow-up me-1"></i>
                            +12.5% so với tháng trước
                        </div>
                    </div>
                    <div class="bg-white bg-opacity-25 rounded-circle p-3">
                        <i class="fas fa-chart-line fs-4"></i>
                    </div>
                </div>
            </div>
            <a href="@Url.Action("MovieDashboard", "Admins")"
               class="card-footer bg-white border-0 text-dark text-decoration-none py-3 hover-effect">
                <div class="d-flex justify-content-between align-items-center small fw-medium">
                    <span>Xem phân tích phim</span>
                    <i class="fas fa-arrow-right transition-icon"></i>
                </div>
            </a>
        </div>
    </div>
</div>

<!-- Quick Actions & Recent Activity -->
<div class="row g-4 mb-4">
    <!-- Quick Actions -->
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-bottom-0 py-3">
                <h6 class="card-title mb-0 fw-semibold">
                    <i class="fas fa-bolt text-primary me-2"></i>Thao tác nhanh
                </h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-6">
                        <a href="@Url.Action("Create", "AdminMovie")" class="btn btn-outline-primary w-100 py-3">
                            <i class="fas fa-plus-circle mb-2 d-block fs-4"></i>
                            <small>Thêm phim mới</small>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="@Url.Action("Create", "AdminShowTime")" class="btn btn-outline-success w-100 py-3">
                            <i class="fas fa-calendar-plus mb-2 d-block fs-4"></i>
                            <small>Tạo suất chiếu</small>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="@Url.Action("Create", "AdminUser")" class="btn btn-outline-info w-100 py-3">
                            <i class="fas fa-user-plus mb-2 d-block fs-4"></i>
                            <small>Thêm người dùng</small>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="@Url.Action("MovieDashboard", "Admins")" class="btn btn-outline-warning w-100 py-3">
                            <i class="fas fa-chart-bar mb-2 d-block fs-4"></i>
                            <small>Xem báo cáo</small>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Status -->
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-bottom-0 py-3">
                <h6 class="card-title mb-0 fw-semibold">
                    <i class="fas fa-server text-success me-2"></i>Trạng thái hệ thống
                </h6>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="d-flex align-items-center">
                        <div class="bg-success rounded-circle p-1 me-2">
                            <div class="bg-white rounded-circle" style="width: 8px; height: 8px;"></div>
                        </div>
                        <div>
                            <div class="fw-medium">Hệ thống</div>
                            <small class="text-muted">Hoạt động bình thường</small>
                        </div>
                    </div>
                    <span class="badge bg-success">Online</span>
                </div>
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="d-flex align-items-center">
                        <div class="bg-info rounded-circle p-1 me-2">
                            <div class="bg-white rounded-circle" style="width: 8px; height: 8px;"></div>
                        </div>
                        <div>
                            <div class="fw-medium">Cơ sở dữ liệu</div>
                            <small class="text-muted">Kết nối ổn định</small>
                        </div>
                    </div>
                    <span class="badge bg-info">Active</span>
                </div>
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <div class="bg-warning rounded-circle p-1 me-2">
                            <div class="bg-white rounded-circle" style="width: 8px; height: 8px;"></div>
                        </div>
                        <div>
                            <div class="fw-medium">Bảo trì</div>
                            <small class="text-muted">Lên lịch 02:00 AM</small>
                        </div>
                    </div>
                    <span class="badge bg-warning">Scheduled</span>
                </div>
            </div>
        </div>
    </div>
</div>

@if ((ViewBag.TotalRevenue ?? 0) == 0 && ViewBag.ErrorMessage == null)
{
    <!-- Quick Start Guide -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm bg-gradient" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <div class="d-flex align-items-center mb-3">
                                <div class="bg-primary rounded-circle p-3 me-3">
                                    <i class="fas fa-rocket text-white fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="fw-bold text-dark mb-1">Chào mừng đến với DKMovies Admin!</h5>
                                    <p class="text-muted mb-0">Bắt đầu thiết lập hệ thống của bạn</p>
                                </div>
                            </div>
                            <p class="text-muted mb-4">
                                Hệ thống đang chờ dữ liệu khởi tạo. Hãy thêm phim, tạo suất chiếu và mời người dùng để bắt đầu.
                            </p>
                            <div class="d-flex flex-wrap gap-2">
                                <a href="@Url.Action("Index", "AdminMovie")" class="btn btn-primary">
                                    <i class="fas fa-film me-2"></i>Quản lý phim
                                </a>
                                <a href="@Url.Action("Index", "AdminShowTime")" class="btn btn-outline-primary">
                                    <i class="fas fa-clock me-2"></i>Tạo suất chiếu
                                </a>
                                <a href="@Url.Action("Index", "AdminUser")" class="btn btn-outline-secondary">
                                    <i class="fas fa-users me-2"></i>Quản lý người dùng
                                </a>
                            </div>
                        </div>
                        <div class="col-md-4 text-center">
                            <i class="fas fa-chart-line text-primary opacity-25" style="font-size: 6rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<style>
    .dashboard-card {
        transition: all 0.3s ease;
        cursor: pointer;
    }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
        }

    .hover-effect {
        transition: all 0.3s ease;
    }

        .hover-effect:hover {
            background-color: rgba(0,0,0,0.02) !important;
        }

    .transition-icon {
        transition: transform 0.3s ease;
    }

    .hover-effect:hover .transition-icon {
        transform: translateX(3px);
    }

    .progress {
        background: rgba(255,255,255,0.2);
    }

    .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .card {
        transition: all 0.3s ease;
    }

    {
        opacity: 0;
        transform: translateY(30px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }

    }

    .dashboard-card {
        animation: fadeInUp 0.6s ease forwards;
    }

        .dashboard-card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .dashboard-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dashboard-card:nth-child(3) {
            animation-delay: 0.3s;
        }

        .dashboard-card:nth-child(4) {
            animation-delay: 0.4s;
        }
</style>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add click animation to cards
            document.querySelectorAll('.dashboard-card').forEach(card => {
                card.addEventListener('click', function(e) {
                    if (e.target.tagName !== 'A') {
                        const link = this.querySelector('a');
                        if (link) {
                            window.location.href = link.href;
                        }
                    }
                });
            });

            // Auto refresh data every 5 minutes
            setInterval(function() {
                const refreshBtn = document.querySelector('.btn-outline-primary');
                if (refreshBtn && refreshBtn.textContent.includes('Làm mới')) {
                    refreshBtn.classList.add('btn-loading');
                    setTimeout(() => {
                        refreshBtn.classList.remove('btn-loading');
                    }, 1000);
                }
            }, 300000);
        });
    </script>
}